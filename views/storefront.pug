// Fixed: Declared language for better accessibility
doctype html
html(lang="en")
    head
        meta(charset="utf-8")
        title CreatureCo
        meta(name="viewport", content="width=device-width, initial-scale=1")
        link(rel="stylesheet", href="/css/storefront.css")
    body 
        header
            .logo 
                a(href="/storefront") CreatureCo
            form.search-bar(action="/search" method="POST")
                input(name="keyword" id="userInput" type="text", placeholder="Search products..." required)
                button(type="submit") ðŸ”Ž
            .menu
                button#button-menu(onclick="openMenu()")
                    img(src="/images/menu.png", alt="menu" width="30" height="30")
            .menu-open-close.hidden#menu
                .user-actions-menu
                    a(href="/" id="auth-link") Login/Register
                    a(href="/storefront") Home
                    a(href="#") Shop
                    a(href="/about") About
                    a(href="#") Contact
                    .cart-icon 
                        a(href="/checkout") ðŸ›’

            .user-actions
                a(href="/" id="auth-link") Login/Register
                a(href="/storefront") Home
                a(href="#") Shop
                a(href="/about") About
                a(href="#") Contact
                .cart-icon 
                    a(href="/checkout") ðŸ›’
        .welcome
        h1(id="welcome") Welcome, Guest!
        main
            h2 Latest Products:
            .product-grid
                each val, key in products
                    .product-box
                        a(href=`/product/${val.id}`)
                            .product 
                                img(src=val.imageUrl alt="Image of Product") 
                                .product-name= val.name 
                                .product-price= "$" + val.price
                                .product-desc= val.description
        footer
            // Optional enhancement: wrapped text in <p> tag for semantics
            p Â© 2025 CreatureCo. All rights reserved.
        // Added: safer JWT decode function to handle URL-safe base64
        script.
            function decodeJWT(token) {
                const base64 = token.split('.')[1].replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                return JSON.parse(jsonPayload);
            }

            document.addEventListener("DOMContentLoaded", function () 
            {
                const token = localStorage.getItem("authToken");
                if (token) 
                {
                    const welcomeEl = document.getElementById("welcome");
                    const navLinks = document.querySelectorAll("#auth-link");

                    try 
                    {
                        const user = decodeJWT(token);
                        if (user && user.dbres2 && user.dbres2.firstname) 
                        {
                            welcomeEl.textContent = `Welcome back, ${user.dbres2.firstname}!`;
                            navLinks.forEach((nav) => 
                            {
                                nav.textContent = "My Profile";
                                nav.href = "/profile";
                            });
                        }
                    } 
                    catch (err) 
                    {
                        console.error("Failed to decode JWT:", err);
                    }
                }        
            });

        // No change: Menu toggle remains the same
        script.
            function openMenu() {
                const menu = document.getElementById('menu');
                menu.classList.toggle('hidden');
            }
