html
  head
    meta(charset="utf-8")
    title My Cart
    meta(name="viewport", content="width=device-width, initial-scale=1")
    link(rel="stylesheet", href="/css/checkout.css")
  body
    header
      .logo 
        a(href="/storefront") CreatureCo
      .search-bar
        input(type="text", placeholder="Search products...")
      .user-actions 
        a(href="/" id="auth-link") Login/Register
        a(href="/storefront") Home
        a(href="#") Shop
        a(href="/about") About
        a(href="#") Contact
        .cart-icon 
          a(href="/checkout") üõí

    main 
      .cart-container#cart-items
        // Les produits seront ins√©r√©s ici dynamiquement

      .purchase-container
        h1 The products in your cart are:
        .cart-list-container#cart-list
        .total
          strong Total: 
          span#cart-total $0.00
        button(type="button") Check Out

    footer
      | ¬© 2025 CreatureCo. All rights reserved.
    script. 
        document.addEventListener("DOMContentLoaded", function () {
            const token = localStorage.getItem("authToken");
            if (token) {
                const nav = document.getElementById("auth-link");
                nav.textContent = "My Profile";
                nav.href = "/profile";
            }        
        });
    script.
        document.addEventListener("DOMContentLoaded", function () {
            const token = localStorage.getItem("authToken");
            
            if (token) {
            const nav = document.getElementById("auth-link");
            nav.textContent = "My Profile";
            nav.href = "/profile";

            fetch('/checkout/api', {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + token
                }
            })
            .then(res => res.json())
            .then(data => {
                const cartItems = document.getElementById("cart-items");
                const cartList = document.getElementById("cart-list");
                const cartTotal = document.getElementById("cart-total");

                let subTotal = 0;

                data.products.forEach(product => {
                    subTotal += product.price;

                    // Section visuelle avec image + infos
                    const item = document.createElement("div");
                    item.classList.add("cart-item");
                    item.innerHTML = `
                    <img src="${product.imageUrl || '/images/default.png'}" alt="Image of ${product.name}">
                    <div class="product-name">${product.name}</div>
                    <div class="product-price">$${product.price.toFixed(2)}</div>
                    <div class="product-desc">${product.description || ''}</div>
                    `;
                    cartItems.appendChild(item);

                    // Ligne textuelle dans la liste
                    const listItem = document.createElement("div");
                    listItem.classList.add("cart-list");
                    listItem.textContent = product.name;
                    cartList.appendChild(listItem);
                });

                cartTotal.textContent = `$${subTotal.toFixed(2)}`;
            })
            .catch(err => console.error("Erreur lors de la r√©cup√©ration du panier :", err));
            }
        });